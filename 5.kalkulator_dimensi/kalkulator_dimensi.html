<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Angka Multi-Kelompok Dinamis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        /* CSS untuk pewarnaan hasil kalkulasi */
        .result-min {
            background-color: #d4edda; /* Light green */
            color: #15552c; /* Darker green for text */
            font-weight: bold;
        }
        .result-max {
            background-color: #e0ccff; /* Light purple */
            color: #4b0082; /* Darker purple for text */
            font-weight: bold;
        }
        .result-average {
            background-color: #cce5ff; /* Light blue */
            color: #004085; /* Darker blue for text */
            font-weight: bold;
        }

        /* --- Perubahan untuk Tampilan Mobile --- */
        .group-section {
            border: 1px solid #dee2e6;
            padding: 0.8rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            background-color: #f8f9fa;
        }

        .group-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .group-header {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            min-width: 100px;
            flex-grow: 1;
            /* Perbaikan posisi teks agar vertikal center */
            display: flex;
            align-items: center; /* Memusatkan teks secara vertikal */
        }
        .group-header[contenteditable="true"]:hover {
            background-color: #e9ecef;
            cursor: text;
        }
        .group-header[contenteditable="true"]:focus {
            outline: 1px solid #007bff;
        }

        .input-group-row {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .input-col {
            flex: 1;
            min-width: 70px; /* Base min-width for all screens */
            margin-bottom: 0 !important;
        }

        .input-col .form-control {
            height: 2.5rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        .input-col label {
            font-size: 0.75rem;
            padding-top: 0.6rem;
            padding-bottom: 0.2rem;
        }

        /* Styling for Specification Section */
        .spec-section {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px dashed #ced4da;
        }
        .spec-section .spec-input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            justify-content: center;
        }
        .spec-section .spec-input-col {
            flex: 1;
            min-width: 90px; /* Base min-width for spec inputs */
        }
        .spec-section .form-floating label {
            font-size: 0.7rem;
            padding-top: 0.5rem;
            padding-bottom: 0.1rem;
        }
        .spec-section .form-floating .form-control {
            height: 2.2rem;
            font-size: 0.8rem;
        }

        /* --- Warna Merah untuk Pelanggaran Spesifikasi --- */
        .input-violates-spec {
            background-color: #fce8e6 !important; /* Soft red for input violation */
            border-color: #dc3545 !important;
            color: #dc3545 !important;
        }
        .result-violates-avg-spec {
            background-color: #ffcccc !important; /* Stronger red for average result violation */
            border-color: #dc3545 !important;
            color: #dc3545 !important;
        }

        .result-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        .result-item {
            flex: 1;
            text-align: center;
            border: 1px solid #ddd;
            padding: 0.3rem 0.5rem;
            border-radius: 0.25rem;
            min-width: 60px;
            font-size: 0.875rem;
        }
        .result-item .result-label {
            font-size: 0.75rem;
            margin-bottom: 0.1rem;
            font-weight: normal;
        }
        .result-item .result-value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .group-action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn-add-group {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            border: 1px solid #0d6efd;
            background-color: #0d6efd;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-add-group:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
            transform: scale(1.1);
        }

        .btn-clear-group-inputs { /* New button style */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            border: 1px solid #ffc107; /* Bootstrap warning border */
            background-color: #ffc107; /* Bootstrap warning color */
            color: #212529; /* Dark text for warning */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-clear-group-inputs:hover {
            background-color: #e0a800;
            border-color: #d39e00;
            transform: scale(1.1);
        }

        .btn-delete-group-bottom {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            border: 1px solid #dc3545;
            background-color: #dc3545;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-delete-group-bottom:hover {
            background-color: #c82333;
            border-color: #bd2130;
            transform: scale(1.1);
        }

        /* Footer styling */
        footer {
            margin-top: 50px; /* Space above footer */
            padding: 20px;
            text-align: center;
            color: #6c757d; /* Muted text color */
            font-size: 0.85rem;
            background-color: #f8f9fa; /* Light background */
            border-top: 1px solid #e9ecef; /* Subtle top border */
        }


        /* Responsive adjustments for smaller screens */
        @media (max-width: 767.98px) {
            .input-group-row .input-col {
                flex-basis: calc(33.333% - 0.5rem); /* Force 3 columns per row for inputs */
                min-width: 0; /* Allow inputs to shrink to fit */
            }
            .result-display .result-item {
                 flex-basis: calc(33.33% - 0.5rem); /* Keep results as 3 per row */
            }
            .spec-section .spec-input-col {
                flex-basis: calc(33.333% - 0.5rem); /* Force 3 columns per row for specs */
                min-width: 0; /* Allow spec inputs to shrink to fit */
            }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="mb-4 text-center">Kalkulator Angka Multi-Kelompok</h2>

        <hr>

        <div id="groupsContainer">
            </div>

    </div>

    <footer>
        Made by Williyanto Adi 2025 v25.0608
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const groupsContainer = document.getElementById('groupsContainer');

            let groupCounter = 0;
            const allGroupsData = [];

            function getDecimalPlaces(numString) {
                const parts = String(numString).split('.');
                if (parts.length < 2 || parts[1] === '') {
                    return 0;
                }
                return parts[1].length;
            }

            function saveAllData() {
                allGroupsData.length = 0;
                groupsContainer.querySelectorAll('.group-section').forEach(groupDiv => {
                    const groupId = parseInt(groupDiv.id.replace('group-', ''));
                    const groupTitle = groupDiv.querySelector('.group-header').textContent.trim();
                    const groupInputs = [];
                    groupDiv.querySelectorAll('.number-input').forEach(input => {
                        groupInputs.push(input.value);
                    });
                    const spekMin = groupDiv.querySelector(`#spekMinInput-${groupId}`).value;
                    const spekMax = groupDiv.querySelector(`#spekMaxInput-${groupId}`).value;
                    const spekAverage = groupDiv.querySelector(`#spekAverageInput-${groupId}`).value;

                    const minResult = groupDiv.querySelector(`#minResult-${groupId}`).textContent;
                    const maxResult = groupDiv.querySelector(`#maxResult-${groupId}`).textContent;
                    const averageResult = groupDiv.querySelector(`#averageResult-${groupId}`).textContent;

                    allGroupsData.push({
                        id: groupId,
                        title: groupTitle,
                        inputs: groupInputs,
                        specs: {
                            min: spekMin,
                            max: spekMax,
                            average: spekAverage
                        },
                        results: {
                            min: minResult,
                            max: maxResult,
                            average: averageResult
                        }
                    });
                });
                localStorage.setItem('kalkulatorData', JSON.stringify(allGroupsData));
                localStorage.setItem('groupCounter', groupCounter);
            }

            function loadAllData() {
                const savedData = localStorage.getItem('kalkulatorData');
                const savedCounter = localStorage.getItem('groupCounter');

                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    groupCounter = savedCounter ? parseInt(savedCounter) : 0;
                    groupsContainer.innerHTML = '';

                    parsedData.forEach(data => {
                        createGroup(data);
                    });

                    if (groupsContainer.children.length === 0) {
                        createGroup();
                    }
                } else {
                    createGroup();
                }
            }

            function createGroup(initialData = null) {
                if (!initialData) {
                    groupCounter++;
                } else {
                    groupCounter = Math.max(groupCounter, initialData.id);
                }
                const groupId = initialData ? initialData.id : groupCounter;

                const groupDiv = document.createElement('div');
                groupDiv.className = 'group-section';
                groupDiv.id = `group-${groupId}`;
                groupDiv.innerHTML = `
                    <div class="group-header-row">
                        <div class="group-header" contenteditable="true">${initialData ? initialData.title : `Item ${groupId}`}</div>
                    </div>

                    <div class="input-group-row" id="inputRow-${groupId}"></div>

                    <div class="result-display">
                        <div class="result-item result-min">
                            <div class="result-label">Min</div>
                            <div class="result-value" id="minResult-${groupId}">${initialData ? initialData.results.min : '0'}</div>
                        </div>
                        <div class="result-item result-max">
                            <div class="result-label">Max</div>
                            <div class="result-value" id="maxResult-${groupId}">${initialData ? initialData.results.max : '0'}</div>
                        </div>
                        <div class="result-item result-average">
                            <div class="result-label">Avg</div>
                            <div class="result-value" id="averageResult-${groupId}">${initialData ? initialData.results.average : '0'}</div>
                        </div>
                    </div>

                    <div class="spec-section">
                        <h6 class="text-center mb-3">Fungsi Spesifikasi</h6>
                        <div class="spec-input-row">
                            <div class="spec-input-col">
                                <div class="form-floating">
                                    <input type="number" class="form-control spec-input" id="spekMinInput-${groupId}" placeholder="Spek Min" step="any" value="${initialData && initialData.specs.min !== '' ? initialData.specs.min : ''}">
                                    <label for="spekMinInput-${groupId}">Spek Min</label>
                                </div>
                            </div>
                            <div class="spec-input-col">
                                <div class="form-floating">
                                    <input type="number" class="form-control spec-input" id="spekMaxInput-${groupId}" placeholder="Spek Max" step="any" value="${initialData && initialData.specs.max !== '' ? initialData.specs.max : ''}">
                                    <label for="spekMaxInput-${groupId}">Spek Max</label>
                                </div>
                            </div>
                            <div class="spec-input-col">
                                <div class="form-floating">
                                    <input type="number" class="form-control spec-input" id="spekAverageInput-${groupId}" placeholder="Spek Avg" step="any" value="${initialData && initialData.specs.average !== '' ? initialData.specs.average : ''}">
                                    <label for="spekAverageInput-${groupId}">Spek Avg</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="group-action-buttons">
                        <button type="button" class="btn btn-primary btn-add-group" id="addNextGroupBtn-${groupId}"
                                data-bs-toggle="tooltip" data-bs-placement="top" title="Tambahkan item lainnya">
                            <i class="bi bi-plus"></i>
                        </button>
                        <button type="button" class="btn btn-danger btn-delete-group-bottom" id="deleteGroupBottomBtn-${groupId}"
                                data-bs-toggle="tooltip" data-bs-placement="top" title="Hapus item kelompok ini">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button type="button" class="btn btn-warning btn-clear-group-inputs" id="clearGroupInputsBtn-${groupId}"
                                data-bs-toggle="tooltip" data-bs-placement="top" title="Hapus data input">
                            <i class="bi bi-x-circle"></i> </button>
                    </div>
                `;
                groupsContainer.appendChild(groupDiv);

                const groupHeader = groupDiv.querySelector('.group-header');
                const currentGroupInputElements = [];
                const inputRow = document.getElementById(`inputRow-${groupId}`);
                const addNextGroupBtn = document.getElementById(`addNextGroupBtn-${groupId}`);
                const deleteGroupBottomBtn = document.getElementById(`deleteGroupBottomBtn-${groupId}`);
                const clearGroupInputsBtn = document.getElementById(`clearGroupInputsBtn-${groupId}`);

                const minResult = document.getElementById(`minResult-${groupId}`);
                const maxResult = document.getElementById(`maxResult-${groupId}`);
                const averageResult = document.getElementById(`averageResult-${groupId}`);

                const spekMinInput = document.getElementById(`spekMinInput-${groupId}`);
                const spekMaxInput = document.getElementById(`spekMaxInput-${groupId}`);
                const spekAverageInput = document.getElementById(`spekAverageInput-${groupId}`);

                const numInputsPerGroup = 6;

                function calculateGroupResults() {
                    const numbers = [];
                    let maxDecimalPlaces = 0;

                    averageResult.classList.remove('result-violates-avg-spec');
                    currentGroupInputElements.forEach(inputElem => {
                        inputElem.classList.remove('input-violates-spec');
                    });

                    currentGroupInputElements.forEach(inputElem => {
                        const inputValue = inputElem.value;
                        const value = parseFloat(inputValue);

                        if (!isNaN(value) && inputValue !== '') {
                            numbers.push(value);
                            maxDecimalPlaces = Math.max(maxDecimalPlaces, getDecimalPlaces(inputValue));
                        }
                    });

                    maxDecimalPlaces = numbers.length > 0 ? maxDecimalPlaces : 0;

                    if (numbers.length > 0) {
                        const minVal = Math.min(...numbers);
                        const maxVal = Math.max(...numbers);
                        const sum = numbers.reduce((a, b) => a + b, 0);
                        const avgVal = sum / numbers.length;

                        minResult.textContent = minVal.toFixed(maxDecimalPlaces);
                        maxResult.textContent = maxVal.toFixed(maxDecimalPlaces);
                        averageResult.textContent = avgVal.toFixed(maxDecimalPlaces);

                        const spekMin = parseFloat(spekMinInput.value);
                        const spekMax = parseFloat(spekMaxInput.value);
                        const spekAverage = parseFloat(spekAverageInput.value);

                        currentGroupInputElements.forEach(inputElem => {
                            const inputValue = inputElem.value;
                            const value = parseFloat(inputValue);

                            if (!isNaN(value) && inputValue !== '') {
                                if (!isNaN(spekMin) && value < spekMin) {
                                    inputElem.classList.add('input-violates-spec');
                                }
                                if (!isNaN(spekMax) && value > spekMax) {
                                    inputElem.classList.add('input-violates-spec');
                                }
                            }
                        });

                        if (!isNaN(spekAverage)) {
                            if (avgVal < spekAverage) {
                                averageResult.classList.add('result-violates-avg-spec');
                            }
                        }

                    } else {
                        minResult.textContent = '0';
                        maxResult.textContent = '0';
                        averageResult.textContent = '0';
                    }
                    saveAllData();
                }

                for (let i = 0; i < numInputsPerGroup; i++) {
                    const colDiv = document.createElement('div');
                    colDiv.className = 'input-col';
                    colDiv.innerHTML = `
                        <div class="form-floating">
                            <input type="number" class="form-control number-input" id="numberInput-${groupId}-${i}" placeholder="Input ${i + 1}" step="any" value="${initialData && initialData.inputs[i] !== '' ? initialData.inputs[i] : ''}">
                            <label for="numberInput-${groupId}-${i}">${initialData ? `${initialData.title} ${i + 1}` : `Input ${i + 1}`}</label>
                        </div>
                    `;
                    inputRow.appendChild(colDiv);
                    const inputElem = document.getElementById(`numberInput-${groupId}-${i}`);
                    currentGroupInputElements.push(inputElem);

                    inputElem.addEventListener('input', calculateGroupResults);
                    inputElem.addEventListener('keydown', function(event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            const currentIndex = currentGroupInputElements.indexOf(inputElem);
                            if (currentIndex !== -1 && currentIndex < currentGroupInputElements.length - 1) {
                                currentGroupInputElements[currentIndex + 1].focus();
                            } else if (currentGroupInputElements.length > 0) {
                                currentGroupInputElements[0].focus();
                            }
                        }
                    });
                    inputElem.addEventListener('change', function() {
                        const currentIndex = currentGroupInputElements.indexOf(inputElem);
                        if (this.value !== '' && currentIndex !== -1 && currentIndex < currentGroupInputElements.length - 1) {
                            currentGroupInputElements[currentIndex + 1].focus();
                        }
                        saveAllData();
                    });
                }

                spekMinInput.addEventListener('input', calculateGroupResults);
                spekMaxInput.addEventListener('input', calculateGroupResults);
                spekAverageInput.addEventListener('input', calculateGroupResults);

                clearGroupInputsBtn.addEventListener('click', function() {
                    currentGroupInputElements.forEach(input => {
                        input.value = '';
                    });
                    spekMinInput.value = '';
                    spekMaxInput.value = '';
                    spekAverageInput.value = '';

                    calculateGroupResults();
                    if (currentGroupInputElements.length > 0) {
                        currentGroupInputElements[0].focus();
                    }
                    saveAllData();
                });

                deleteGroupBottomBtn.addEventListener('click', function() {
                    groupDiv.remove();
                    saveAllData();
                    if (groupsContainer.children.length === 0) {
                        createGroup();
                    }
                });

                addNextGroupBtn.addEventListener('click', function() {
                    createGroup();
                    saveAllData();
                });

                groupHeader.addEventListener('input', function() {
                    let newBaseName = groupHeader.textContent.trim();
                    if (newBaseName === '') {
                        newBaseName = 'Input';
                    }

                    currentGroupInputElements.forEach((inputElem, i) => {
                        const labelElem = inputElem.nextElementSibling;
                        if (labelElem && labelElem.tagName === 'LABEL') {
                            labelElem.textContent = `${newBaseName} ${i + 1}`;
                        }
                    });
                    saveAllData();
                });

                const tooltipTriggerList = groupDiv.querySelectorAll('[data-bs-toggle="tooltip"]');
                const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

                if (initialData) {
                    calculateGroupResults();
                }
            }

            loadAllData();
        });
    </script>
</body>
</html>